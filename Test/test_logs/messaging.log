======================================
开始测试消息系统功能
日期: Fri Aug 15 18:15:39 CST 2025
======================================
[0;32m步骤 1: 获取群聊历史消息[0m
用户获取群聊消息: Redis 查询失败: dial tcp [::1]:6379: connect: connection refused
[0;32m步骤 2: 用户发送第一条消息[0m
用户第一条消息: 保存消息失败: 保存消息失败: pq: insert or update on table "messages" violates foreign key constraint "messages_groupid_fkey"
[0;32m步骤 3: 商家回复消息[0m
商家回复: Invalid token for user
[0;32m步骤 4: 商家通知出餐完成[0m
商家出餐通知: Invalid token for user
[0;32m步骤 5: 骑手通知配送中[0m
骑手出发通知: Invalid token for user
[0;32m步骤 6: 骑手发送位置更新[0m
骑手位置更新: Invalid token for user
[0;32m步骤 7: 用户额外询问[0m
用户追问: 保存消息失败: 保存消息失败: pq: insert or update on table "messages" violates foreign key constraint "messages_groupid_fkey"
[0;32m步骤 8: 骑手回复取餐细节[0m
骑手取餐详情: Invalid token for user
[0;32m步骤 9: 配送完成后确认[0m
配送完成消息: Invalid token for user
[0;32m步骤 10: 用户感谢回复[0m
用户感谢: 保存消息失败: 保存消息失败: pq: insert or update on table "messages" violates foreign key constraint "messages_groupid_fkey"
[0;32m步骤 11: 获取完整聊天记录[0m
[0;32m步骤 12: 消息系统验证[0m
群内总消息数: 0
用户消息数: 0
商家消息数: 0
骑手消息数: 0
[0;32m步骤 13: 消息性能测试[0m
开始测试短时间内发送多条消息的性能...
[0;32m✓ 批量消息发送完成[0m
[0;32m步骤 14: 错误场景测试[0m
测试向不存在的群组发送消息...
非存在群组响应: 保存消息失败: 保存消息失败: pq: insert or update on table "messages" violates foreign key constraint "messages_groupid_fkey"
无效Token响应: Invalid Token
======================================
消息系统测试完成总结
======================================
群聊ID: 1001
测试消息角色组合:
[0;34mUser Role:
✓ 发送询问消息n✓ 回复确认消息n✓ 发送感谢消息[0m
[1;33mShop Role:
✓ 回复订单确认
✓ 通知出餐完成[0m
[0;32mRider Role:
✓ 配送开始通知
✓ 位置更新通知
✓ 送达确认通知[0m

测试数据统计:
总消息数: 0
用户消息: 0
商家消息: 0
骑手消息: 0

[0;32m所有测试数据已保存到 test_data/ 目录[0m
[0;32m详细日志请查看 test_logs/messaging.log[0m
======================================
======================================
开始测试消息系统功能
日期: Fri Aug 15 18:16:40 CST 2025
======================================
[0;32m步骤 1: 获取群聊历史消息[0m
用户获取群聊消息: Redis 查询失败: dial tcp [::1]:6379: connect: connection refused
[0;32m步骤 2: 用户发送第一条消息[0m
用户第一条消息: 保存消息失败: 保存消息失败: pq: insert or update on table "messages" violates foreign key constraint "messages_groupid_fkey"
[0;32m步骤 3: 商家回复消息[0m
商家回复: Invalid token for user
[0;32m步骤 4: 商家通知出餐完成[0m
商家出餐通知: Invalid token for user
[0;32m步骤 5: 骑手通知配送中[0m
骑手出发通知: Invalid token for user
[0;32m步骤 6: 骑手发送位置更新[0m
骑手位置更新: Invalid token for user
[0;32m步骤 7: 用户额外询问[0m
用户追问: 保存消息失败: 保存消息失败: pq: insert or update on table "messages" violates foreign key constraint "messages_groupid_fkey"
[0;32m步骤 8: 骑手回复取餐细节[0m
骑手取餐详情: Invalid token for user
[0;32m步骤 9: 配送完成后确认[0m
配送完成消息: Invalid token for user
[0;32m步骤 10: 用户感谢回复[0m
用户感谢: 保存消息失败: 保存消息失败: pq: insert or update on table "messages" violates foreign key constraint "messages_groupid_fkey"
[0;32m步骤 11: 获取完整聊天记录[0m
[0;32m步骤 12: 消息系统验证[0m
群内总消息数: 0
用户消息数: 0
商家消息数: 0
骑手消息数: 0
[0;32m步骤 13: 消息性能测试[0m
开始测试短时间内发送多条消息的性能...
[0;32m✓ 批量消息发送完成[0m
[0;32m步骤 14: 错误场景测试[0m
测试向不存在的群组发送消息...
非存在群组响应: 保存消息失败: 保存消息失败: pq: insert or update on table "messages" violates foreign key constraint "messages_groupid_fkey"
无效Token响应: Invalid Token
======================================
消息系统测试完成总结
======================================
群聊ID: 1001
测试消息角色组合:
[0;34mUser Role:
✓ 发送询问消息n✓ 回复确认消息n✓ 发送感谢消息[0m
[1;33mShop Role:
✓ 回复订单确认
✓ 通知出餐完成[0m
[0;32mRider Role:
✓ 配送开始通知
✓ 位置更新通知
✓ 送达确认通知[0m

测试数据统计:
总消息数: 0
用户消息: 0
商家消息: 0
骑手消息: 0

[0;32m所有测试数据已保存到 test_data/ 目录[0m
[0;32m详细日志请查看 test_logs/messaging.log[0m
======================================
======================================
开始测试消息系统功能
日期: Fri Aug 15 18:17:40 CST 2025
======================================
[0;32m步骤 1: 获取群聊历史消息[0m
用户获取群聊消息: Redis 查询失败: dial tcp [::1]:6379: connect: connection refused
[0;32m步骤 2: 用户发送第一条消息[0m
用户第一条消息: 保存消息失败: 保存消息失败: pq: insert or update on table "messages" violates foreign key constraint "messages_groupid_fkey"
[0;32m步骤 3: 商家回复消息[0m
商家回复: Invalid token for user
[0;32m步骤 4: 商家通知出餐完成[0m
商家出餐通知: Invalid token for user
[0;32m步骤 5: 骑手通知配送中[0m
骑手出发通知: Invalid token for user
[0;32m步骤 6: 骑手发送位置更新[0m
骑手位置更新: Invalid token for user
[0;32m步骤 7: 用户额外询问[0m
用户追问: 保存消息失败: 保存消息失败: pq: insert or update on table "messages" violates foreign key constraint "messages_groupid_fkey"
[0;32m步骤 8: 骑手回复取餐细节[0m
骑手取餐详情: Invalid token for user
[0;32m步骤 9: 配送完成后确认[0m
配送完成消息: Invalid token for user
[0;32m步骤 10: 用户感谢回复[0m
用户感谢: 保存消息失败: 保存消息失败: pq: insert or update on table "messages" violates foreign key constraint "messages_groupid_fkey"
[0;32m步骤 11: 获取完整聊天记录[0m
[0;32m步骤 12: 消息系统验证[0m
群内总消息数: 0
用户消息数: 0
商家消息数: 0
骑手消息数: 0
[0;32m步骤 13: 消息性能测试[0m
开始测试短时间内发送多条消息的性能...
[0;32m✓ 批量消息发送完成[0m
[0;32m步骤 14: 错误场景测试[0m
测试向不存在的群组发送消息...
非存在群组响应: 保存消息失败: 保存消息失败: pq: insert or update on table "messages" violates foreign key constraint "messages_groupid_fkey"
无效Token响应: Invalid Token
======================================
消息系统测试完成总结
======================================
群聊ID: 1001
测试消息角色组合:
[0;34mUser Role:
✓ 发送询问消息n✓ 回复确认消息n✓ 发送感谢消息[0m
[1;33mShop Role:
✓ 回复订单确认
✓ 通知出餐完成[0m
[0;32mRider Role:
✓ 配送开始通知
✓ 位置更新通知
✓ 送达确认通知[0m

测试数据统计:
总消息数: 0
用户消息: 0
商家消息: 0
骑手消息: 0

[0;32m所有测试数据已保存到 test_data/ 目录[0m
[0;32m详细日志请查看 test_logs/messaging.log[0m
======================================
